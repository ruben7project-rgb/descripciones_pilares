<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Flujos de Interconexión - ESTRATEGO SIG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden;
        }
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
        }
        main {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            width: 100%;
            max-width: 1200px;
            height: 95%;
            position: relative;
        }
        .pillar {
            position: absolute;
            width: 180px;
            padding: 15px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            font-weight: 500;
            transition: all 0.3s ease;
            border-top: 5px solid;
            transform: translate(-50%, -50%);
        }
        .pillar.central {
            width: 220px;
            padding: 20px;
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
            z-index: 10;
        }
        .connection-line {
            position: absolute;
            background: #cbd5e1;
            height: 2px;
            transform-origin: left center;
            z-index: 1;
        }
        .arrow {
            position: absolute;
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            z-index: 2;
            transform-origin: center;
        }
        .arrow-out {
            border-left: 10px solid #2563eb;
        }
        .arrow-in {
            border-right: 10px solid #16a34a;
        }
        .legend {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            gap: 20px;
            font-size: 0.8rem;
            z-index: 20;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color-in {
            width: 15px;
            height: 15px;
            background: #16a34a;
            border-radius: 3px;
        }
        .legend-color-out {
            width: 15px;
            height: 15px;
            background: #2563eb;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <nav class="bg-white shadow-md w-full">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex items-center space-x-2">
                <span class="text-xl font-bold text-indigo-700">ESTRATEGO SIG</span>
                <span class="text-xl text-slate-500">/</span>
                <span class="text-xl font-semibold">Visualizador de Flujos de Interconexión</span>
            </div>
        </div>
    </nav>
    <main>
        <div class="container" id="container">
            <!-- Pilares y líneas se generarán aquí -->
        </div>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color-in"></div>
                <span>ENTRADA de información</span>
            </div>
            <div class="legend-item">
                <div class="legend-color-out"></div>
                <span>SALIDA de información</span>
            </div>
        </div>
    </main>

<script>
const pillarData = {
    1: { name: 'Humano', color: '#3b82f6' },
    2: { name: 'Procesos', color: '#22c55e' },
    3: { name: 'Personalización', color: '#f97316' },
    4: { name: 'Presupuesto', color: '#ef4444' },
    5: { name: 'Prospectivo', color: '#8b5cf6' },
    6: { name: 'Operacional', color: '#14b8a6' },
    7: { name: 'Planning', color: '#0ea5e9' },
    8: { name: 'Project Mgmt', color: '#64748b' },
    9: { name: 'Cliente & Mercado', color: '#ec4899' },
    10: { name: 'Estrategias & Tácticas', color: '#a3e635' }
};

const connections = {
    1: { inputs: [8, 2, 4, 6], outputs: [8, 2, 4, 5] },
    2: { inputs: [1, 6, 8], outputs: [1, 6, 8, 3, 4] },
    3: { inputs: [1,2,4,5,6,7,8,9,10], outputs: [5, 6, 2, 8, 10] },
    4: { inputs: [], outputs: [8, 5, 1, 10] },
    5: { inputs: [9, 6, 8], outputs: [9, 6, 8] },
    6: { inputs: [2, 1, 9], outputs: [5, 1, 9] },
    7: { inputs: [5, 1, 9], outputs: [8, 6] },
    8: { inputs: [6, 1, 2], outputs: [6, 1, 2] },
    9: { inputs: [6, 8, 5], outputs: [6, 8, 5] },
    10: { inputs: [], outputs: [5, 3, 1] }
};

function drawVisualization() {
    const container = document.getElementById('container');
    container.innerHTML = ''; // Limpiar antes de redibujar

    const urlParams = new URLSearchParams(window.location.search);
    const centralPillarId = parseInt(urlParams.get('pilar') || '1', 10);

    const centralPillarData = pillarData[centralPillarId];
    const centralPillarConnections = connections[centralPillarId];

    const containerWidth = container.clientWidth;
    const containerHeight = container.clientHeight;
    const centerX = containerWidth / 2;
    const centerY = containerHeight / 2;
    
    // Crear pilar central
    const centralNode = document.createElement('div');
    centralNode.id = `pillar-${centralPillarId}`;
    centralNode.className = 'pillar central';
    centralNode.textContent = `${centralPillarId}. ${centralPillarData.name}`;
    centralNode.style.borderColor = centralPillarData.color;
    centralNode.style.backgroundColor = centralPillarData.color;
    centralNode.style.left = `${centerX}px`;
    centralNode.style.top = `${centerY}px`;
    container.appendChild(centralNode);

    // Crear pilares periféricos
    const otherPillars = Object.keys(pillarData).filter(id => parseInt(id) !== centralPillarId);
    const angleStep = (2 * Math.PI) / otherPillars.length;
    const radiusX = containerWidth / 2 - 120; // Radio dinámico
    const radiusY = containerHeight / 2 - 80; // Radio dinámico

    otherPillars.forEach((id, index) => {
        const angle = index * angleStep - Math.PI / 2;
        const x = centerX + radiusX * Math.cos(angle);
        const y = centerY + radiusY * Math.sin(angle);
        
        const pillarNode = document.createElement('div');
        pillarNode.id = `pillar-${id}`;
        pillarNode.className = 'pillar';
        pillarNode.textContent = `${id}. ${pillarData[id].name}`;
        pillarNode.style.borderColor = pillarData[id].color;
        pillarNode.style.left = `${x}px`;
        pillarNode.style.top = `${y}px`;
        container.appendChild(pillarNode);
    });

    // Dibujar conexiones
    otherPillars.forEach(id => {
        const isInput = centralPillarConnections.inputs.includes(parseInt(id));
        const isOutput = centralPillarConnections.outputs.includes(parseInt(id));

        if (isInput || isOutput) {
            const pillarEl = document.getElementById(`pillar-${id}`);
            const pillarRect = pillarEl.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();

            const pillarX = pillarRect.left - containerRect.left + pillarRect.width / 2;
            const pillarY = pillarRect.top - containerRect.top + pillarRect.height / 2;

            const angle = Math.atan2(pillarY - centerY, pillarX - centerX);
            const distance = Math.hypot(pillarX - centerX, pillarY - centerY);

            if (isOutput) {
                drawConnection(centerX, centerY, pillarX, pillarY, angle, distance, 'out');
            }
            if (isInput) {
                drawConnection(pillarX, pillarY, centerX, centerY, angle + Math.PI, distance, 'in');
            }
        }
    });
}

function drawConnection(startX, startY, endX, endY, angle, distance, type) {
    const container = document.getElementById('container');
    const centralNodeRadius = 110;
    const pillarNodeRadius = 90;
    const adjustedDistance = distance - centralNodeRadius - pillarNodeRadius;

    const line = document.createElement('div');
    line.className = 'connection-line';
    line.style.left = `${startX + centralNodeRadius * Math.cos(angle)}px`;
    line.style.top = `${startY + centralNodeRadius * Math.sin(angle)}px`;
    line.style.width = `${adjustedDistance > 0 ? adjustedDistance : 0}px`;
    line.style.transform = `rotate(${angle}rad)`;
    container.appendChild(line);

    const arrow = document.createElement('div');
    arrow.className = `arrow ${type === 'in' ? 'arrow-in' : 'arrow-out'}`;
    
    const midX = startX + (endX - startX) * 0.5;
    const midY = startY + (endY - startY) * 0.5;

    arrow.style.left = `${midX}px`;
    arrow.style.top = `${midY}px`;
    arrow.style.transform = `translate(-50%, -50%) rotate(${angle}rad)`;
    container.appendChild(arrow);
}

document.addEventListener('DOMContentLoaded', drawVisualization);
window.addEventListener('resize', drawVisualization);

</script>
</body>
</html>

